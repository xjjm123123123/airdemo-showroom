# AI 巡检分析工作流说明

## 🎯 功能概述

AI 巡检分析功能模拟了一个完整的智能巡检流程，从选择点位到输出结果卡片，展示了 AI + 多维表格的完整闭环。

## 📋 工作流程

### 1. 用户操作
- 在 AILY 分析工作台选择点位（如：东门卫-仓库、生产车间A区等）
- 点击"开始分析"按钮

### 2. 思考过程（模拟 P2 效果）

系统会显示逐步的思考过程：

```
🤔 正在思考...

📋 调用人员违规判断工作流
```

然后逐步添加：

```
🤔 正在思考并生成答案...

📋 调用人员违规判断工作流
📍 正在查询点位图像数据
```

继续：

```
🤔 正在思考并生成答案...

📋 调用人员违规判断工作流
📍 正在查询点位图像数据
🔍 正在进行 AI 视觉分析
```

最后：

```
🤔 正在思考并生成答案...

📋 调用人员违规判断工作流
📍 正在查询点位图像数据
🔍 正在进行 AI 视觉分析
📊 正在生成分析报告
```

### 3. 输出结果卡片（模拟 P3 效果）

思考过程完成后，会输出一张精美的违规识别卡片，包含：

**卡片头部：**
- 🚨 AI 巡检违规识别（橙红色渐变背景）

**图像区域：**
- 显示违规现场图片
- 右上角标签显示违规类型

**违规信息卡片（红色）：**
- 🚨 违规情况
- 类型：在岗玩手机 / 不符合5s标准 / 睡岗等
- 置信度：85%-97%
- 描述：详细的违规描述

**位置信息卡片（蓝色）：**
- 📍 位置信息
- 点位：东门卫-仓库
- 部门：生产部 / 行政部

**时间信息卡片（紫色）：**
- ⏰ 时间信息
- 日期：2025/12/25
- 抓取时间：2025-12-25 14:30:45

**操作按钮：**
- 查看详细记录（橙红色渐变按钮）

### 4. 自动写入记录

如果检测到违规，系统会自动：
- 将记录写入「人员违规数据表」
- 更新本地数据显示
- 显示确认消息：✅ 违规记录已自动写入「人员违规数据表」

## 🎨 设计特点

### 1. 渐进式思考展示
- 模拟真实的 AI 思考过程
- 每个步骤有适当的延迟（800ms → 600ms → 500ms → 400ms）
- 给用户清晰的进度反馈

### 2. 卡片式结果展示
- 参考飞书卡片设计规范
- 使用颜色区分不同信息类型
- 信息层次清晰，易于阅读

### 3. 动画效果
- 消息淡入动画（animate-fadeIn）
- 思考过程脉冲动画（animate-pulse）
- 按钮悬停效果

## 🔧 技术实现

### 组件结构

```
views/Workspace.tsx
├── executeInspectionAnalysis()  # 主流程函数
└── 消息渲染
    ├── 文本消息
    └── 卡片消息
        └── ViolationCard 组件

components/ViolationCard.tsx
├── 头部（标题 + 图标）
├── 图像区域
├── 违规信息卡片
├── 位置信息卡片
├── 时间信息卡片
└── 操作按钮
```

### 消息类型

```typescript
{
  role: 'ai' | 'user';
  text?: string;  // 普通文本消息
  card?: {        // 卡片消息
    type: 'violation';
    data: {
      imageUrl: string;
      violationType: string;
      confidence: number;
      description: string;
      location: string;
      department: string;
      date: string;
      time: string;
    };
  };
}
```

## 📊 数据流

```
用户选择点位
    ↓
显示思考过程（4个步骤）
    ↓
查询多维表格数据
    ↓
调用 AI 视觉分析 API
    ↓
生成结果卡片
    ↓
写入违规记录（如有）
    ↓
完成
```

## 🎯 演示效果

1. **多维表格视图**和**应用模式**都支持
2. 思考过程清晰可见
3. 结果卡片美观专业
4. 自动化闭环完整

## 💡 使用建议

### 演示时的话术

1. **开始分析：**
   "现在我选择一个点位，比如'东门卫-仓库'，点击开始分析"

2. **思考过程：**
   "可以看到，系统正在调用人员违规判断工作流，查询图像数据，进行 AI 视觉分析"

3. **结果展示：**
   "分析完成后，系统输出了一张详细的违规识别卡片，包含图像、违规类型、置信度、位置、部门、时间等完整信息"

4. **自动化闭环：**
   "检测到违规后，记录已经自动写入多维表格，实现了从发现到记录的完整闭环"

## 🔍 调试信息

浏览器控制台会显示详细的调试日志：
- 🔍 使用中转 API 进行图像分析
- 📍 分析点位
- 🔑 API Key
- 📥 正在获取图片
- ✅ 图片已转换为 base64
- 📤 发送请求
- 📨 响应状态
- ✅ API 响应成功
- 📝 AI 返回内容
